# Description: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
from aiogram import Router, types
import admin
import feedback
from aiogram.filters import BaseFilter
import mistralaiclient
from aiogram.types import Message
import geminiaiclient
import config
import command_gen
import forai
from logs.logs import logs
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°
user_message_router = Router()
# ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
# Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ½Ğ°
class Access_to_the_bot(BaseFilter):
    def __init__(self, user_access: list[int]):
        self.user_access = user_access
    async def __call__(self, message: Message) -> bool:
        return message.from_user.id in self.user_access
@user_message_router.message(Access_to_the_bot(user_access=config.user_access_list),)
async def user_message_get(message: types.Message):
    #Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸
    user_name = message.from_user.username
    user_id = message.from_user.id
    print(f"{forai.now_time()} -> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ±Ğ¾Ñ‚Ñƒ->   {user_name} ({user_id}): {message.text}")
    logs(user_id, user_name, f"{forai.now_time()} -> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ±Ğ¾Ñ‚Ñƒ-> {user_name} ({user_id}): {message.text}")
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    config = admin.get_user_config(message.from_user.id)
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ GladiusAI
    if admin.GladiusAI_status == False:
        await message.reply("""GladiusAI Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚.
ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.ğŸ˜“""")
        return
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ feedback
    if feedback.feedback_status == True:
        await feedback.feedback_message_write(message)
        feedback.feedback_status = False
        return
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ÑƒÑ Ğ˜Ğ˜
    match config["ai_right_now"]:
        case "mistral_ai_client":
            await mistralaiclient.mistral_answer(message)
            user_id = message.from_user.id
        case "gemini_ai_client":
            await geminiaiclient.gemini_answer(message)
            user_id = message.from_user.id
#Ğ£ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ±Ğ¾Ñ‚Ñƒ
@user_message_router.message()
async def user_message_get(message: types.Message):
    await message.reply(command_gen.user_access_list_gen(message.from_user.id, message.from_user.username, message.text or "ĞĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"))
    user_name = message.from_user.username
    user_id = message.from_user.id
    print(f"{forai.now_time()} -> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ±Ğ¾Ñ‚Ñƒ->   {user_name} ({user_id}): {message.text}")
    logs(user_id, user_name, f"{forai.now_time()} -> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ±Ğ¾Ñ‚Ñƒ-> {user_name} ({user_id}): {message.text}")